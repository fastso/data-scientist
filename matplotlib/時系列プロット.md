# 時系列プロット

## 時系列データのプロット

多くのデータが時系列で整理されています。 可視化は時系列データのパターンを検出するための優れた方法です。

サンプルデータとして以下を使用します。

```csv
date,value01,value02
2021-01-01,1,100
2021-01-02,3,300
2021-01-03,2,200
2021-01-04,4,400
2021-01-05,3,300
2021-01-06,5,500
2021-01-07,4,400
2021-01-08,6,600
2021-01-09,5,500
2021-01-10,7,700
2021-01-11,6,600
2021-01-12,8,800
2021-01-13,7,700
2021-01-14,9,900
2021-01-15,8,800
2021-01-16,10,1000
```

日付をインデックスとして読込みます。[pandas.read_csv](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html)

```python
import pandas as pd

df = pd.read_csv('csv/時系列プロット.csv', parse_dates=['date'], index_col='date')
```

時系列データのプロット

```python
import matplotlib.pyplot as plt

fig, ax = plt.subplots()

# Add the time-series for "relative_temp" to the plot
ax.plot(df.index, df['value01'])

ax.set_xlabel('Date')
ax.set_ylabel('Value01')
plt.show()
```

時系列のズームイン

```python
import matplotlib.pyplot as plt

# Use plt.subplots to create fig and ax
fig, ax = plt.subplots()

# Create variable seventies with data from "1970-01-01" to "1979-12-31"
df_zoom_in = df['2021-01-01':'2021-01-05']

# Add the time-series for "co2" data from seventies to the plot
ax.plot(df_zoom_in.index, df_zoom_in["value01"])

# Show the figure
plt.show()
```

## 異なる変数を用いた時系列プロット

2つの変数のプロット

```python
import matplotlib.pyplot as plt

# Initalize a Figure and Axes
fig, ax = plt.subplots()

# Plot the CO2 variable in blue
ax.plot(df.index, df['value01'], color='b')

# Create a twin Axes that shares the x-axis
ax2 = ax.twinx()

# Plot the relative temperature in red
ax2.plot(df.index, df['value02'], color='r')

plt.show()
```

時系列データをプロットする関数を定義してみる

```python
# Define a function called plot_timeseries
def plot_timeseries(axes, x, y, color, xlabel, ylabel):
    # Plot the inputs x,y in the provided color
    axes.plot(x, y, color=color)

    # Set the x-axis label
    axes.set_xlabel(xlabel)

    # Set the y-axis label
    axes.set_ylabel(ylabel, color=color)

    # Set the colors tick params for y-axis
    axes.tick_params('y', colors=color)
```

定義した関数を使ってみる

```python

fig, ax = plt.subplots()

# Plot the CO2 levels time-series in blue
plot_timeseries(ax, climate_change.index, climate_change['co2'], "blue", 'Time (years)',
                'CO2 levels')

# Create a twin Axes object that shares the x-axis
ax2 = ax.twinx()

# Plot the relative temperature data in red
plot_timeseries(ax2, climate_change.index, climate_change['relative_temp'], "red",
                'Time (years)', 'Relative temperature (Celsius)')

plt.show()
```

## 時系列データの注釈

```python
fig, ax = plt.subplots()

# Plot the CO2 levels time-series in blue
plot_timeseries(ax, climate_change.index, climate_change['co2'], 'blue', 'Time (years)',
                'CO2 levels')

# Create an Axes object that shares the x-axis
ax2 = ax.twinx()

# Plot the relative temperature data in red
plot_timeseries(ax2, climate_change.index, climate_change['relative_temp'], 'red',
                'Time (years)', 'Relative temp (Celsius)')

# Annotate point with relative temperature >1 degree
ax2.annotate(">1 degree", xy=(pd.Timestamp('2015-10-06'), 1),
             xytext=(pd.Timestamp('2008-10-06'), -0.2),
             arrowprops={'arrowstyle': '->', 'color': 'gray'})

plt.show()
```